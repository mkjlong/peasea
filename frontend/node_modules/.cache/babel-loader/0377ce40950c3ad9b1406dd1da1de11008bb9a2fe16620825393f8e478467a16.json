{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.decode = exports.extract = exports.Page = void 0;\nvar inner_field_1 = require(\"./inner_field\");\nvar buffer_1 = require(\"./buffer\");\nvar defines_1 = require(\"./defines\");\nvar action_1 = require(\"./action\");\nvar comments_1 = require(\"./comments\");\nvar quiz_1 = require(\"./quiz\");\nvar field_1 = require(\"./field\");\nvar Page = /** @class */function () {\n  function Page(index, field, operation, comment, flags, refs) {\n    this.index = index;\n    this.operation = operation;\n    this.comment = comment;\n    this.flags = flags;\n    this.refs = refs;\n    this._field = field.copy();\n  }\n  Object.defineProperty(Page.prototype, \"field\", {\n    get: function () {\n      return new field_1.Field(this._field.copy());\n    },\n    set: function (field) {\n      this._field = (0, inner_field_1.createInnerField)(field);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Page.prototype.mino = function () {\n    return field_1.Mino.from(this.operation);\n  };\n  return Page;\n}();\nexports.Page = Page;\nvar FieldConstants = {\n  GarbageLine: 1,\n  Width: 10\n};\nfunction extract(str) {\n  var format = function (version, data) {\n    var trim = data.trim().replace(/[?\\s]+/g, '');\n    return {\n      version: version,\n      data: trim\n    };\n  };\n  var data = str;\n  // url parameters\n  var paramIndex = data.indexOf('&');\n  if (0 <= paramIndex) {\n    data = data.substring(0, paramIndex);\n  }\n  // v115@~\n  {\n    var match = str.match(/[vmd]115@/);\n    if (match !== undefined && match !== null && match.index !== undefined) {\n      var sub = data.substr(match.index + 5);\n      return format('115', sub);\n    }\n  }\n  // v110@~\n  {\n    var match = str.match(/[vmd]110@/);\n    if (match !== undefined && match !== null && match.index !== undefined) {\n      var sub = data.substr(match.index + 5);\n      return format('110', sub);\n    }\n  }\n  throw new Error('Unsupported fumen version');\n}\nexports.extract = extract;\nfunction decode(fumen) {\n  var _a = extract(fumen),\n    version = _a.version,\n    data = _a.data;\n  switch (version) {\n    case '115':\n      return innerDecode(data, 23);\n    case '110':\n      return innerDecode(data, 21);\n  }\n  throw new Error('Unsupported fumen version');\n}\nexports.decode = decode;\nfunction innerDecode(data, fieldTop) {\n  var fieldMaxHeight = fieldTop + FieldConstants.GarbageLine;\n  var numFieldBlocks = fieldMaxHeight * FieldConstants.Width;\n  var buffer = new buffer_1.Buffer(data);\n  var updateField = function (prev) {\n    var result = {\n      changed: true,\n      field: prev\n    };\n    var index = 0;\n    while (index < numFieldBlocks) {\n      var diffBlock = buffer.poll(2);\n      var diff = Math.floor(diffBlock / numFieldBlocks);\n      var numOfBlocks = diffBlock % numFieldBlocks;\n      if (diff === 8 && numOfBlocks === numFieldBlocks - 1) {\n        result.changed = false;\n      }\n      for (var block = 0; block < numOfBlocks + 1; block += 1) {\n        var x = index % FieldConstants.Width;\n        var y = fieldTop - Math.floor(index / FieldConstants.Width) - 1;\n        result.field.addNumber(x, y, diff - 8);\n        index += 1;\n      }\n    }\n    return result;\n  };\n  var pageIndex = 0;\n  var prevField = (0, inner_field_1.createNewInnerField)();\n  var store = {\n    repeatCount: -1,\n    refIndex: {\n      comment: 0,\n      field: 0\n    },\n    quiz: undefined,\n    lastCommentText: ''\n  };\n  var pages = [];\n  var actionDecoder = (0, action_1.createActionDecoder)(FieldConstants.Width, fieldTop, FieldConstants.GarbageLine);\n  var commentDecoder = (0, comments_1.createCommentParser)();\n  while (!buffer.isEmpty()) {\n    // Parse field\n    var currentFieldObj = void 0;\n    if (0 < store.repeatCount) {\n      currentFieldObj = {\n        field: prevField,\n        changed: false\n      };\n      store.repeatCount -= 1;\n    } else {\n      currentFieldObj = updateField(prevField.copy());\n      if (!currentFieldObj.changed) {\n        store.repeatCount = buffer.poll(1);\n      }\n    }\n    // Parse action\n    var actionValue = buffer.poll(3);\n    var action = actionDecoder.decode(actionValue);\n    // Parse comment\n    var comment = void 0;\n    if (action.comment) {\n      // コメントに更新があるとき\n      var commentValues = [];\n      var commentLength = buffer.poll(2);\n      for (var commentCounter = 0; commentCounter < Math.floor((commentLength + 3) / 4); commentCounter += 1) {\n        var commentValue = buffer.poll(5);\n        commentValues.push(commentValue);\n      }\n      var flatten = '';\n      for (var _i = 0, commentValues_1 = commentValues; _i < commentValues_1.length; _i++) {\n        var value = commentValues_1[_i];\n        flatten += commentDecoder.decode(value);\n      }\n      var commentText = unescape(flatten.slice(0, commentLength));\n      store.lastCommentText = commentText;\n      comment = {\n        text: commentText\n      };\n      store.refIndex.comment = pageIndex;\n      var text = comment.text;\n      if (quiz_1.Quiz.isQuizComment(text)) {\n        try {\n          store.quiz = new quiz_1.Quiz(text);\n        } catch (e) {\n          store.quiz = undefined;\n        }\n      } else {\n        store.quiz = undefined;\n      }\n    } else if (pageIndex === 0) {\n      // コメントに更新がないが、先頭のページのとき\n      comment = {\n        text: ''\n      };\n    } else {\n      // コメントに更新がないとき\n      comment = {\n        text: store.quiz !== undefined ? store.quiz.format().toString() : undefined,\n        ref: store.refIndex.comment\n      };\n    }\n    // Quiz用の操作を取得し、次ページ開始時点のQuizに1手進める\n    var quiz = false;\n    if (store.quiz !== undefined) {\n      quiz = true;\n      if (store.quiz.canOperate() && action.lock) {\n        if ((0, defines_1.isMinoPiece)(action.piece.type)) {\n          try {\n            var nextQuiz = store.quiz.nextIfEnd();\n            var operation = nextQuiz.getOperation(action.piece.type);\n            store.quiz = nextQuiz.operate(operation);\n          } catch (e) {\n            // console.error(e.message);\n            // Not operate\n            store.quiz = store.quiz.format();\n          }\n        } else {\n          store.quiz = store.quiz.format();\n        }\n      }\n    }\n    // データ処理用に加工する\n    var currentPiece = void 0;\n    if (action.piece.type !== defines_1.Piece.Empty) {\n      currentPiece = action.piece;\n    }\n    // pageの作成\n    var field = void 0;\n    if (currentFieldObj.changed || pageIndex === 0) {\n      // フィールドに変化があったとき\n      // フィールドに変化がなかったが、先頭のページだったとき\n      field = {};\n      store.refIndex.field = pageIndex;\n    } else {\n      // フィールドに変化がないとき\n      field = {\n        ref: store.refIndex.field\n      };\n    }\n    pages.push(new Page(pageIndex, currentFieldObj.field, currentPiece !== undefined ? field_1.Mino.from({\n      type: (0, defines_1.parsePieceName)(currentPiece.type),\n      rotation: (0, defines_1.parseRotationName)(currentPiece.rotation),\n      x: currentPiece.x,\n      y: currentPiece.y\n    }) : undefined, comment.text !== undefined ? comment.text : store.lastCommentText, {\n      quiz: quiz,\n      lock: action.lock,\n      mirror: action.mirror,\n      colorize: action.colorize,\n      rise: action.rise\n    }, {\n      field: field.ref,\n      comment: comment.ref\n    }));\n    // callback(\n    //     currentFieldObj.field.copy()\n    //     , currentPiece\n    //     , store.quiz !== undefined ? store.quiz.format().toString() : store.lastCommentText,\n    // );\n    pageIndex += 1;\n    if (action.lock) {\n      if ((0, defines_1.isMinoPiece)(action.piece.type)) {\n        currentFieldObj.field.fill(action.piece);\n      }\n      currentFieldObj.field.clearLine();\n      if (action.rise) {\n        currentFieldObj.field.riseGarbage();\n      }\n      if (action.mirror) {\n        currentFieldObj.field.mirror();\n      }\n    }\n    prevField = currentFieldObj.field;\n  }\n  return pages;\n}","map":{"version":3,"names":["Object","defineProperty","exports","value","decode","extract","Page","inner_field_1","require","buffer_1","defines_1","action_1","comments_1","quiz_1","field_1","index","field","operation","comment","flags","refs","_field","copy","prototype","get","Field","set","createInnerField","enumerable","configurable","mino","Mino","from","FieldConstants","GarbageLine","Width","str","format","version","data","trim","replace","paramIndex","indexOf","substring","match","undefined","sub","substr","Error","fumen","_a","innerDecode","fieldTop","fieldMaxHeight","numFieldBlocks","buffer","Buffer","updateField","prev","result","changed","diffBlock","poll","diff","Math","floor","numOfBlocks","block","x","y","addNumber","pageIndex","prevField","createNewInnerField","store","repeatCount","refIndex","quiz","lastCommentText","pages","actionDecoder","createActionDecoder","commentDecoder","createCommentParser","isEmpty","currentFieldObj","actionValue","action","commentValues","commentLength","commentCounter","commentValue","push","flatten","_i","commentValues_1","length","commentText","unescape","slice","text","Quiz","isQuizComment","e","toString","ref","canOperate","lock","isMinoPiece","piece","type","nextQuiz","nextIfEnd","getOperation","operate","currentPiece","Piece","Empty","parsePieceName","rotation","parseRotationName","mirror","colorize","rise","fill","clearLine","riseGarbage"],"sources":["C:/Stuff/Github/peasea/node_modules/tetris-fumen/lib/decoder.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.decode = exports.extract = exports.Page = void 0;\nvar inner_field_1 = require(\"./inner_field\");\nvar buffer_1 = require(\"./buffer\");\nvar defines_1 = require(\"./defines\");\nvar action_1 = require(\"./action\");\nvar comments_1 = require(\"./comments\");\nvar quiz_1 = require(\"./quiz\");\nvar field_1 = require(\"./field\");\nvar Page = /** @class */ (function () {\n    function Page(index, field, operation, comment, flags, refs) {\n        this.index = index;\n        this.operation = operation;\n        this.comment = comment;\n        this.flags = flags;\n        this.refs = refs;\n        this._field = field.copy();\n    }\n    Object.defineProperty(Page.prototype, \"field\", {\n        get: function () {\n            return new field_1.Field(this._field.copy());\n        },\n        set: function (field) {\n            this._field = (0, inner_field_1.createInnerField)(field);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Page.prototype.mino = function () {\n        return field_1.Mino.from(this.operation);\n    };\n    return Page;\n}());\nexports.Page = Page;\nvar FieldConstants = {\n    GarbageLine: 1,\n    Width: 10,\n};\nfunction extract(str) {\n    var format = function (version, data) {\n        var trim = data.trim().replace(/[?\\s]+/g, '');\n        return { version: version, data: trim };\n    };\n    var data = str;\n    // url parameters\n    var paramIndex = data.indexOf('&');\n    if (0 <= paramIndex) {\n        data = data.substring(0, paramIndex);\n    }\n    // v115@~\n    {\n        var match = str.match(/[vmd]115@/);\n        if (match !== undefined && match !== null && match.index !== undefined) {\n            var sub = data.substr(match.index + 5);\n            return format('115', sub);\n        }\n    }\n    // v110@~\n    {\n        var match = str.match(/[vmd]110@/);\n        if (match !== undefined && match !== null && match.index !== undefined) {\n            var sub = data.substr(match.index + 5);\n            return format('110', sub);\n        }\n    }\n    throw new Error('Unsupported fumen version');\n}\nexports.extract = extract;\nfunction decode(fumen) {\n    var _a = extract(fumen), version = _a.version, data = _a.data;\n    switch (version) {\n        case '115':\n            return innerDecode(data, 23);\n        case '110':\n            return innerDecode(data, 21);\n    }\n    throw new Error('Unsupported fumen version');\n}\nexports.decode = decode;\nfunction innerDecode(data, fieldTop) {\n    var fieldMaxHeight = fieldTop + FieldConstants.GarbageLine;\n    var numFieldBlocks = fieldMaxHeight * FieldConstants.Width;\n    var buffer = new buffer_1.Buffer(data);\n    var updateField = function (prev) {\n        var result = {\n            changed: true,\n            field: prev,\n        };\n        var index = 0;\n        while (index < numFieldBlocks) {\n            var diffBlock = buffer.poll(2);\n            var diff = Math.floor(diffBlock / numFieldBlocks);\n            var numOfBlocks = diffBlock % numFieldBlocks;\n            if (diff === 8 && numOfBlocks === numFieldBlocks - 1) {\n                result.changed = false;\n            }\n            for (var block = 0; block < numOfBlocks + 1; block += 1) {\n                var x = index % FieldConstants.Width;\n                var y = fieldTop - Math.floor(index / FieldConstants.Width) - 1;\n                result.field.addNumber(x, y, diff - 8);\n                index += 1;\n            }\n        }\n        return result;\n    };\n    var pageIndex = 0;\n    var prevField = (0, inner_field_1.createNewInnerField)();\n    var store = {\n        repeatCount: -1,\n        refIndex: {\n            comment: 0,\n            field: 0,\n        },\n        quiz: undefined,\n        lastCommentText: '',\n    };\n    var pages = [];\n    var actionDecoder = (0, action_1.createActionDecoder)(FieldConstants.Width, fieldTop, FieldConstants.GarbageLine);\n    var commentDecoder = (0, comments_1.createCommentParser)();\n    while (!buffer.isEmpty()) {\n        // Parse field\n        var currentFieldObj = void 0;\n        if (0 < store.repeatCount) {\n            currentFieldObj = {\n                field: prevField,\n                changed: false,\n            };\n            store.repeatCount -= 1;\n        }\n        else {\n            currentFieldObj = updateField(prevField.copy());\n            if (!currentFieldObj.changed) {\n                store.repeatCount = buffer.poll(1);\n            }\n        }\n        // Parse action\n        var actionValue = buffer.poll(3);\n        var action = actionDecoder.decode(actionValue);\n        // Parse comment\n        var comment = void 0;\n        if (action.comment) {\n            // コメントに更新があるとき\n            var commentValues = [];\n            var commentLength = buffer.poll(2);\n            for (var commentCounter = 0; commentCounter < Math.floor((commentLength + 3) / 4); commentCounter += 1) {\n                var commentValue = buffer.poll(5);\n                commentValues.push(commentValue);\n            }\n            var flatten = '';\n            for (var _i = 0, commentValues_1 = commentValues; _i < commentValues_1.length; _i++) {\n                var value = commentValues_1[_i];\n                flatten += commentDecoder.decode(value);\n            }\n            var commentText = unescape(flatten.slice(0, commentLength));\n            store.lastCommentText = commentText;\n            comment = { text: commentText };\n            store.refIndex.comment = pageIndex;\n            var text = comment.text;\n            if (quiz_1.Quiz.isQuizComment(text)) {\n                try {\n                    store.quiz = new quiz_1.Quiz(text);\n                }\n                catch (e) {\n                    store.quiz = undefined;\n                }\n            }\n            else {\n                store.quiz = undefined;\n            }\n        }\n        else if (pageIndex === 0) {\n            // コメントに更新がないが、先頭のページのとき\n            comment = { text: '' };\n        }\n        else {\n            // コメントに更新がないとき\n            comment = {\n                text: store.quiz !== undefined ? store.quiz.format().toString() : undefined,\n                ref: store.refIndex.comment,\n            };\n        }\n        // Quiz用の操作を取得し、次ページ開始時点のQuizに1手進める\n        var quiz = false;\n        if (store.quiz !== undefined) {\n            quiz = true;\n            if (store.quiz.canOperate() && action.lock) {\n                if ((0, defines_1.isMinoPiece)(action.piece.type)) {\n                    try {\n                        var nextQuiz = store.quiz.nextIfEnd();\n                        var operation = nextQuiz.getOperation(action.piece.type);\n                        store.quiz = nextQuiz.operate(operation);\n                    }\n                    catch (e) {\n                        // console.error(e.message);\n                        // Not operate\n                        store.quiz = store.quiz.format();\n                    }\n                }\n                else {\n                    store.quiz = store.quiz.format();\n                }\n            }\n        }\n        // データ処理用に加工する\n        var currentPiece = void 0;\n        if (action.piece.type !== defines_1.Piece.Empty) {\n            currentPiece = action.piece;\n        }\n        // pageの作成\n        var field = void 0;\n        if (currentFieldObj.changed || pageIndex === 0) {\n            // フィールドに変化があったとき\n            // フィールドに変化がなかったが、先頭のページだったとき\n            field = {};\n            store.refIndex.field = pageIndex;\n        }\n        else {\n            // フィールドに変化がないとき\n            field = { ref: store.refIndex.field };\n        }\n        pages.push(new Page(pageIndex, currentFieldObj.field, currentPiece !== undefined ? field_1.Mino.from({\n            type: (0, defines_1.parsePieceName)(currentPiece.type),\n            rotation: (0, defines_1.parseRotationName)(currentPiece.rotation),\n            x: currentPiece.x,\n            y: currentPiece.y,\n        }) : undefined, comment.text !== undefined ? comment.text : store.lastCommentText, {\n            quiz: quiz,\n            lock: action.lock,\n            mirror: action.mirror,\n            colorize: action.colorize,\n            rise: action.rise,\n        }, {\n            field: field.ref,\n            comment: comment.ref,\n        }));\n        // callback(\n        //     currentFieldObj.field.copy()\n        //     , currentPiece\n        //     , store.quiz !== undefined ? store.quiz.format().toString() : store.lastCommentText,\n        // );\n        pageIndex += 1;\n        if (action.lock) {\n            if ((0, defines_1.isMinoPiece)(action.piece.type)) {\n                currentFieldObj.field.fill(action.piece);\n            }\n            currentFieldObj.field.clearLine();\n            if (action.rise) {\n                currentFieldObj.field.riseGarbage();\n            }\n            if (action.mirror) {\n                currentFieldObj.field.mirror();\n            }\n        }\n        prevField = currentFieldObj.field;\n    }\n    return pages;\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}