{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.encode = void 0;\nvar inner_field_1 = require(\"./inner_field\");\nvar buffer_1 = require(\"./buffer\");\nvar defines_1 = require(\"./defines\");\nvar action_1 = require(\"./action\");\nvar comments_1 = require(\"./comments\");\nvar quiz_1 = require(\"./quiz\");\nvar FieldConstants = {\n  GarbageLine: 1,\n  Width: 10\n};\nfunction encode(pages) {\n  var updateField = function (prev, current) {\n    var _a = encodeField(prev, current),\n      changed = _a.changed,\n      values = _a.values;\n    if (changed) {\n      // フィールドを記録して、リピートを終了する\n      buffer.merge(values);\n      lastRepeatIndex = -1;\n    } else if (lastRepeatIndex < 0 || buffer.get(lastRepeatIndex) === buffer_1.Buffer.tableLength - 1) {\n      // フィールドを記録して、リピートを開始する\n      buffer.merge(values);\n      buffer.push(0);\n      lastRepeatIndex = buffer.length - 1;\n    } else if (buffer.get(lastRepeatIndex) < buffer_1.Buffer.tableLength - 1) {\n      // フィールドは記録せず、リピートを進める\n      var currentRepeatValue = buffer.get(lastRepeatIndex);\n      buffer.set(lastRepeatIndex, currentRepeatValue + 1);\n    }\n  };\n  var lastRepeatIndex = -1;\n  var buffer = new buffer_1.Buffer();\n  var prevField = (0, inner_field_1.createNewInnerField)();\n  var actionEncoder = (0, action_1.createActionEncoder)(FieldConstants.Width, 23, FieldConstants.GarbageLine);\n  var commentParser = (0, comments_1.createCommentParser)();\n  var prevComment = '';\n  var prevQuiz = undefined;\n  var innerEncode = function (index) {\n    var currentPage = pages[index];\n    currentPage.flags = currentPage.flags ? currentPage.flags : {};\n    var field = currentPage.field;\n    var currentField = field !== undefined ? (0, inner_field_1.createInnerField)(field) : prevField.copy();\n    // フィールドの更新\n    updateField(prevField, currentField);\n    // アクションの更新\n    var currentComment = currentPage.comment !== undefined ? index !== 0 || currentPage.comment !== '' ? currentPage.comment : undefined : undefined;\n    var piece = currentPage.operation !== undefined ? {\n      type: (0, defines_1.parsePiece)(currentPage.operation.type),\n      rotation: (0, defines_1.parseRotation)(currentPage.operation.rotation),\n      x: currentPage.operation.x,\n      y: currentPage.operation.y\n    } : {\n      type: defines_1.Piece.Empty,\n      rotation: defines_1.Rotation.Reverse,\n      x: 0,\n      y: 22\n    };\n    var nextComment;\n    if (currentComment !== undefined) {\n      if (currentComment.startsWith('#Q=')) {\n        // Quiz on\n        if (prevQuiz !== undefined && prevQuiz.format().toString() === currentComment) {\n          nextComment = undefined;\n        } else {\n          nextComment = currentComment;\n          prevComment = nextComment;\n          prevQuiz = new quiz_1.Quiz(currentComment);\n        }\n      } else {\n        // Quiz off\n        if (prevQuiz !== undefined && prevQuiz.format().toString() === currentComment) {\n          nextComment = undefined;\n          prevComment = currentComment;\n          prevQuiz = undefined;\n        } else {\n          nextComment = prevComment !== currentComment ? currentComment : undefined;\n          prevComment = prevComment !== currentComment ? nextComment : prevComment;\n          prevQuiz = undefined;\n        }\n      }\n    } else {\n      nextComment = undefined;\n      prevQuiz = undefined;\n    }\n    if (prevQuiz !== undefined && prevQuiz.canOperate() && currentPage.flags.lock) {\n      if ((0, defines_1.isMinoPiece)(piece.type)) {\n        try {\n          var nextQuiz = prevQuiz.nextIfEnd();\n          var operation = nextQuiz.getOperation(piece.type);\n          prevQuiz = nextQuiz.operate(operation);\n        } catch (e) {\n          // console.error(e.message);\n          // Not operate\n          prevQuiz = prevQuiz.format();\n        }\n      } else {\n        prevQuiz = prevQuiz.format();\n      }\n    }\n    var currentFlags = __assign({\n      lock: true,\n      colorize: index === 0\n    }, currentPage.flags);\n    var action = {\n      piece: piece,\n      rise: !!currentFlags.rise,\n      mirror: !!currentFlags.mirror,\n      colorize: !!currentFlags.colorize,\n      lock: !!currentFlags.lock,\n      comment: nextComment !== undefined\n    };\n    var actionNumber = actionEncoder.encode(action);\n    buffer.push(actionNumber, 3);\n    // コメントの更新\n    if (nextComment !== undefined) {\n      var comment = escape(currentPage.comment);\n      var commentLength = Math.min(comment.length, 4095);\n      buffer.push(commentLength, 2);\n      // コメントを符号化\n      for (var index_1 = 0; index_1 < commentLength; index_1 += 4) {\n        var value = 0;\n        for (var count = 0; count < 4; count += 1) {\n          var newIndex = index_1 + count;\n          if (commentLength <= newIndex) {\n            break;\n          }\n          var ch = comment.charAt(newIndex);\n          value += commentParser.encode(ch, count);\n        }\n        buffer.push(value, 5);\n      }\n    } else if (currentPage.comment === undefined) {\n      prevComment = undefined;\n    }\n    // 地形の更新\n    if (action.lock) {\n      if ((0, defines_1.isMinoPiece)(action.piece.type)) {\n        currentField.fill(action.piece);\n      }\n      currentField.clearLine();\n      if (action.rise) {\n        currentField.riseGarbage();\n      }\n      if (action.mirror) {\n        currentField.mirror();\n      }\n    }\n    prevField = currentField;\n  };\n  for (var index = 0; index < pages.length; index += 1) {\n    innerEncode(index);\n  }\n  // テト譜が短いときはそのまま出力する\n  // 47文字ごとに?が挿入されるが、実際は先頭にv115@が入るため、最初の?は42文字後になる\n  var data = buffer.toString();\n  if (data.length < 41) {\n    return data;\n  }\n  // ?を挿入する\n  var head = [data.substr(0, 42)];\n  var tails = data.substring(42);\n  var split = tails.match(/[\\S]{1,47}/g) || [];\n  return head.concat(split).join('?');\n}\nexports.encode = encode;\n// フィールドをエンコードする\n// 前のフィールドがないときは空のフィールドを指定する\n// 入力フィールドの高さは23, 幅は10\nfunction encodeField(prev, current) {\n  var FIELD_TOP = 23;\n  var FIELD_MAX_HEIGHT = FIELD_TOP + 1;\n  var FIELD_BLOCKS = FIELD_MAX_HEIGHT * FieldConstants.Width;\n  var buffer = new buffer_1.Buffer();\n  // 前のフィールドとの差を計算: 0〜16\n  var getDiff = function (xIndex, yIndex) {\n    var y = FIELD_TOP - yIndex - 1;\n    return current.getNumberAt(xIndex, y) - prev.getNumberAt(xIndex, y) + 8;\n  };\n  // データの記録\n  var recordBlockCounts = function (diff, counter) {\n    var value = diff * FIELD_BLOCKS + counter;\n    buffer.push(value, 2);\n  };\n  // フィールド値から連続したブロック数に変換\n  var changed = true;\n  var prev_diff = getDiff(0, 0);\n  var counter = -1;\n  for (var yIndex = 0; yIndex < FIELD_MAX_HEIGHT; yIndex += 1) {\n    for (var xIndex = 0; xIndex < FieldConstants.Width; xIndex += 1) {\n      var diff = getDiff(xIndex, yIndex);\n      if (diff !== prev_diff) {\n        recordBlockCounts(prev_diff, counter);\n        counter = 0;\n        prev_diff = diff;\n      } else {\n        counter += 1;\n      }\n    }\n  }\n  // 最後の連続ブロックを処理\n  recordBlockCounts(prev_diff, counter);\n  if (prev_diff === 8 && counter === FIELD_BLOCKS - 1) {\n    changed = false;\n  }\n  return {\n    changed: changed,\n    values: buffer\n  };\n}","map":{"version":3,"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","defineProperty","exports","value","encode","inner_field_1","require","buffer_1","defines_1","action_1","comments_1","quiz_1","FieldConstants","GarbageLine","Width","pages","updateField","prev","current","_a","encodeField","changed","values","buffer","merge","lastRepeatIndex","get","Buffer","tableLength","push","currentRepeatValue","set","prevField","createNewInnerField","actionEncoder","createActionEncoder","commentParser","createCommentParser","prevComment","prevQuiz","undefined","innerEncode","index","currentPage","flags","field","currentField","createInnerField","copy","currentComment","comment","piece","operation","type","parsePiece","rotation","parseRotation","x","y","Piece","Empty","Rotation","Reverse","nextComment","startsWith","format","toString","Quiz","canOperate","lock","isMinoPiece","nextQuiz","nextIfEnd","getOperation","operate","e","currentFlags","colorize","action","rise","mirror","actionNumber","escape","commentLength","Math","min","index_1","count","newIndex","ch","charAt","fill","clearLine","riseGarbage","data","head","substr","tails","substring","split","match","concat","join","FIELD_TOP","FIELD_MAX_HEIGHT","FIELD_BLOCKS","getDiff","xIndex","yIndex","getNumberAt","recordBlockCounts","diff","counter","prev_diff"],"sources":["C:/Stuff/Github/peasea/frontend/node_modules/tetris-fumen/lib/encoder.js"],"sourcesContent":["\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.encode = void 0;\nvar inner_field_1 = require(\"./inner_field\");\nvar buffer_1 = require(\"./buffer\");\nvar defines_1 = require(\"./defines\");\nvar action_1 = require(\"./action\");\nvar comments_1 = require(\"./comments\");\nvar quiz_1 = require(\"./quiz\");\nvar FieldConstants = {\n    GarbageLine: 1,\n    Width: 10,\n};\nfunction encode(pages) {\n    var updateField = function (prev, current) {\n        var _a = encodeField(prev, current), changed = _a.changed, values = _a.values;\n        if (changed) {\n            // フィールドを記録して、リピートを終了する\n            buffer.merge(values);\n            lastRepeatIndex = -1;\n        }\n        else if (lastRepeatIndex < 0 || buffer.get(lastRepeatIndex) === buffer_1.Buffer.tableLength - 1) {\n            // フィールドを記録して、リピートを開始する\n            buffer.merge(values);\n            buffer.push(0);\n            lastRepeatIndex = buffer.length - 1;\n        }\n        else if (buffer.get(lastRepeatIndex) < (buffer_1.Buffer.tableLength - 1)) {\n            // フィールドは記録せず、リピートを進める\n            var currentRepeatValue = buffer.get(lastRepeatIndex);\n            buffer.set(lastRepeatIndex, currentRepeatValue + 1);\n        }\n    };\n    var lastRepeatIndex = -1;\n    var buffer = new buffer_1.Buffer();\n    var prevField = (0, inner_field_1.createNewInnerField)();\n    var actionEncoder = (0, action_1.createActionEncoder)(FieldConstants.Width, 23, FieldConstants.GarbageLine);\n    var commentParser = (0, comments_1.createCommentParser)();\n    var prevComment = '';\n    var prevQuiz = undefined;\n    var innerEncode = function (index) {\n        var currentPage = pages[index];\n        currentPage.flags = currentPage.flags ? currentPage.flags : {};\n        var field = currentPage.field;\n        var currentField = field !== undefined ? (0, inner_field_1.createInnerField)(field) : prevField.copy();\n        // フィールドの更新\n        updateField(prevField, currentField);\n        // アクションの更新\n        var currentComment = currentPage.comment !== undefined\n            ? ((index !== 0 || currentPage.comment !== '') ? currentPage.comment : undefined)\n            : undefined;\n        var piece = currentPage.operation !== undefined ? {\n            type: (0, defines_1.parsePiece)(currentPage.operation.type),\n            rotation: (0, defines_1.parseRotation)(currentPage.operation.rotation),\n            x: currentPage.operation.x,\n            y: currentPage.operation.y,\n        } : {\n            type: defines_1.Piece.Empty,\n            rotation: defines_1.Rotation.Reverse,\n            x: 0,\n            y: 22,\n        };\n        var nextComment;\n        if (currentComment !== undefined) {\n            if (currentComment.startsWith('#Q=')) {\n                // Quiz on\n                if (prevQuiz !== undefined && prevQuiz.format().toString() === currentComment) {\n                    nextComment = undefined;\n                }\n                else {\n                    nextComment = currentComment;\n                    prevComment = nextComment;\n                    prevQuiz = new quiz_1.Quiz(currentComment);\n                }\n            }\n            else {\n                // Quiz off\n                if (prevQuiz !== undefined && prevQuiz.format().toString() === currentComment) {\n                    nextComment = undefined;\n                    prevComment = currentComment;\n                    prevQuiz = undefined;\n                }\n                else {\n                    nextComment = prevComment !== currentComment ? currentComment : undefined;\n                    prevComment = prevComment !== currentComment ? nextComment : prevComment;\n                    prevQuiz = undefined;\n                }\n            }\n        }\n        else {\n            nextComment = undefined;\n            prevQuiz = undefined;\n        }\n        if (prevQuiz !== undefined && prevQuiz.canOperate() && currentPage.flags.lock) {\n            if ((0, defines_1.isMinoPiece)(piece.type)) {\n                try {\n                    var nextQuiz = prevQuiz.nextIfEnd();\n                    var operation = nextQuiz.getOperation(piece.type);\n                    prevQuiz = nextQuiz.operate(operation);\n                }\n                catch (e) {\n                    // console.error(e.message);\n                    // Not operate\n                    prevQuiz = prevQuiz.format();\n                }\n            }\n            else {\n                prevQuiz = prevQuiz.format();\n            }\n        }\n        var currentFlags = __assign({ lock: true, colorize: index === 0 }, currentPage.flags);\n        var action = {\n            piece: piece,\n            rise: !!currentFlags.rise,\n            mirror: !!currentFlags.mirror,\n            colorize: !!currentFlags.colorize,\n            lock: !!currentFlags.lock,\n            comment: nextComment !== undefined,\n        };\n        var actionNumber = actionEncoder.encode(action);\n        buffer.push(actionNumber, 3);\n        // コメントの更新\n        if (nextComment !== undefined) {\n            var comment = escape(currentPage.comment);\n            var commentLength = Math.min(comment.length, 4095);\n            buffer.push(commentLength, 2);\n            // コメントを符号化\n            for (var index_1 = 0; index_1 < commentLength; index_1 += 4) {\n                var value = 0;\n                for (var count = 0; count < 4; count += 1) {\n                    var newIndex = index_1 + count;\n                    if (commentLength <= newIndex) {\n                        break;\n                    }\n                    var ch = comment.charAt(newIndex);\n                    value += commentParser.encode(ch, count);\n                }\n                buffer.push(value, 5);\n            }\n        }\n        else if (currentPage.comment === undefined) {\n            prevComment = undefined;\n        }\n        // 地形の更新\n        if (action.lock) {\n            if ((0, defines_1.isMinoPiece)(action.piece.type)) {\n                currentField.fill(action.piece);\n            }\n            currentField.clearLine();\n            if (action.rise) {\n                currentField.riseGarbage();\n            }\n            if (action.mirror) {\n                currentField.mirror();\n            }\n        }\n        prevField = currentField;\n    };\n    for (var index = 0; index < pages.length; index += 1) {\n        innerEncode(index);\n    }\n    // テト譜が短いときはそのまま出力する\n    // 47文字ごとに?が挿入されるが、実際は先頭にv115@が入るため、最初の?は42文字後になる\n    var data = buffer.toString();\n    if (data.length < 41) {\n        return data;\n    }\n    // ?を挿入する\n    var head = [data.substr(0, 42)];\n    var tails = data.substring(42);\n    var split = tails.match(/[\\S]{1,47}/g) || [];\n    return head.concat(split).join('?');\n}\nexports.encode = encode;\n// フィールドをエンコードする\n// 前のフィールドがないときは空のフィールドを指定する\n// 入力フィールドの高さは23, 幅は10\nfunction encodeField(prev, current) {\n    var FIELD_TOP = 23;\n    var FIELD_MAX_HEIGHT = FIELD_TOP + 1;\n    var FIELD_BLOCKS = FIELD_MAX_HEIGHT * FieldConstants.Width;\n    var buffer = new buffer_1.Buffer();\n    // 前のフィールドとの差を計算: 0〜16\n    var getDiff = function (xIndex, yIndex) {\n        var y = FIELD_TOP - yIndex - 1;\n        return current.getNumberAt(xIndex, y) - prev.getNumberAt(xIndex, y) + 8;\n    };\n    // データの記録\n    var recordBlockCounts = function (diff, counter) {\n        var value = diff * FIELD_BLOCKS + counter;\n        buffer.push(value, 2);\n    };\n    // フィールド値から連続したブロック数に変換\n    var changed = true;\n    var prev_diff = getDiff(0, 0);\n    var counter = -1;\n    for (var yIndex = 0; yIndex < FIELD_MAX_HEIGHT; yIndex += 1) {\n        for (var xIndex = 0; xIndex < FieldConstants.Width; xIndex += 1) {\n            var diff = getDiff(xIndex, yIndex);\n            if (diff !== prev_diff) {\n                recordBlockCounts(prev_diff, counter);\n                counter = 0;\n                prev_diff = diff;\n            }\n            else {\n                counter += 1;\n            }\n        }\n    }\n    // 最後の連続ブロックを処理\n    recordBlockCounts(prev_diff, counter);\n    if (prev_diff === 8 && counter === FIELD_BLOCKS - 1) {\n        changed = false;\n    }\n    return {\n        changed: changed,\n        values: buffer,\n    };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}